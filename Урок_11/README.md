# Урок 11: Използване на Amazon SNS за съобщения

## Цели на урока
- Да разберем какво е Amazon SNS и как работи
- Да се научим да създаваме и конфигурираме SNS теми
- Да се запознаем с основните функции на SNS (публикуване, абонаменти, филтриране)
- Да разберем как да интегрираме SNS с други AWS услуги
- Да създадем прост проект, използвайки SNS и други AWS услуги

## Какво е Amazon SNS и как работи?

### Дефиниция на Amazon SNS
Amazon Simple Notification Service (SNS) е напълно управлявана услуга за съобщения, която координира доставката на съобщения до абонати чрез различни протоколи (например HTTP/S, Email, SMS, Lambda). SNS позволява изпращане на съобщения до голям брой получатели едновременно.

### Основни концепции на SNS
- **Теми (Topics)** - логически канали за изпращане на съобщения.
- **Абонаменти (Subscriptions)** - механизми за получаване на съобщения от теми.
- **Публикуване (Publishing)** - изпращане на съобщения до теми.
- **Филтриране (Filtering)** - филтриране на съобщенията, които се доставят до абонатите.
- **Протоколи** - методи за доставка на съобщения (например HTTP/S, Email, SMS, Lambda).

### Как работи SNS?
1. **Създавате SNS тема** - конфигурирате темата и определяте настройки за доставка.
2. **Абонирате получатели** - добавяте абонати към темата чрез различни протоколи.
3. **Публикувате съобщения** - изпращате съобщения до темата.
4. **SNS доставя съобщения** - SNS доставя съобщенията до всички абонати на темата.
5. **Филтриране на съобщения** - SNS филтрира съобщенията според конфигурираните правила.

## Създаване и конфигуриране на SNS тема

### Стъпки за създаване на SNS тема чрез AWS Management Console

#### 1. Отворете SNS конзолата
1. Влезте в AWS Management Console
2. Отидете на услугата "SNS"
3. Кликнете "Create topic"

#### 2. Конфигурирайте основни настройки
1. Въведете име на темата
2. Изберете тип на темата (например Standard, FIFO)
3. Кликнете "Create topic"

#### 3. Конфигурирайте допълнителни настройки
1. Конфигурирайте настройки за доставка:
   - **Retry Policy** - политика за повторни опити при неуспешна доставка
   - **Delivery Status Logging** - логване на статус на доставката
2. Конфигурирайте настройки за сигурност:
   - **Access Policy** - политика за достъп до темата
   - **Encryption** - криптиране на съобщенията
3. Кликнете "Create topic"

### Управление на SNS тема

#### Създаване на абонаменти
1. В SNS конзолата, изберете вашата тема
2. Отидете на раздела "Subscriptions"
3. Кликнете "Create subscription"
4. Изберете протокол (например HTTP/S, Email, SMS, Lambda)
5. Въведете крайна точка (например URL, Email адрес, телефонен номер)
6. Кликнете "Create subscription"

#### Публикуване на съобщения
1. В SNS конзолата, изберете вашата тема
2. Кликнете "Publish message"
3. Въведете съдържание на съобщението (например Subject, Message)
4. Кликнете "Publish message"

#### Филтриране на съобщения
1. В SNS конзолата, изберете вашата тема
2. Отидете на раздела "Subscriptions"
3. Изберете абонамент и кликнете "Edit"
4. Конфигурирайте правила за филтриране (например Message Attributes)
5. Кликнете "Save changes"

## Основни функции на SNS

### Публикуване на съобщения
SNS позволява изпращане на съобщения до теми, които след това се доставят до всички абонати на темата.

#### Публикуване чрез AWS Management Console
1. В SNS конзолата, изберете вашата тема
2. Кликнете "Publish message"
3. Въведете съдържание на съобщението (например Subject, Message)
4. Кликнете "Publish message"

#### Публикуване чрез AWS CLI
```bash
aws sns publish \
  --topic-arn arn:aws:sns:us-east-1:123456789012:MyTopic \
  --message "Hello, this is a test message"
```

### Абонаменти
SNS поддържа различни протоколи за абонаменти, включително HTTP/S, Email, SMS и Lambda.

#### Създаване на абонамент чрез AWS Management Console
1. В SNS конзолата, изберете вашата тема
2. Отидете на раздела "Subscriptions"
3. Кликнете "Create subscription"
4. Изберете протокол (например HTTP/S, Email, SMS, Lambda)
5. Въведете крайна точка (например URL, Email адрес, телефонен номер)
6. Кликнете "Create subscription"

#### Създаване на абонамент чрез AWS CLI
```bash
aws sns subscribe \
  --topic-arn arn:aws:sns:us-east-1:123456789012:MyTopic \
  --protocol email \
  --notification-endpoint user@example.com
```

### Филтриране на съобщения
SNS позволява филтриране на съобщенията, които се доставят до абонатите, чрез използване на Message Attributes.

#### Конфигуриране на филтриране чрез AWS Management Console
1. В SNS конзолата, изберете вашата тема
2. Отидете на раздела "Subscriptions"
3. Изберете абонамент и кликнете "Edit"
4. Конфигурирайте правила за филтриране (например Message Attributes)
5. Кликнете "Save changes"

#### Конфигуриране на филтриране чрез AWS CLI
```bash
aws sns set-subscription-attributes \
  --subscription-arn arn:aws:sns:us-east-1:123456789012:MyTopic:2bcfbf39-05c3-41de-beaa-fcfcc21c8f55 \
  --attribute-name FilterPolicy \
  --attribute-value '{"store":["example_corp"]}'
```

## Интеграция на SNS с други AWS услуги

### Интеграция с Lambda
SNS може да задейства Lambda функции при получаване на съобщения, което позволява автоматична обработка на съобщенията.

#### Създаване на абонамент за Lambda
1. В SNS конзолата, изберете вашата тема
2. Отидете на раздела "Subscriptions"
3. Кликнете "Create subscription"
4. Изберете протокол "Lambda"
5. Въведете ARN на Lambda функцията
6. Кликнете "Create subscription"

### Интеграция с SQS
SNS може да изпраща съобщения до SQS опашки, което позволява асинхронна обработка на съобщенията.

#### Създаване на абонамент за SQS
1. В SNS конзолата, изберете вашата тема
2. Отидете на раздела "Subscriptions"
3. Кликнете "Create subscription"
4. Изберете протокол "SQS"
5. Въведете ARN на SQS опашката
6. Кликнете "Create subscription"

### Интеграция с CloudWatch
SNS може да изпраща известия до CloudWatch аларми, което позволява автоматично уведомяване при достигане на определени метрики.

#### Създаване на CloudWatch аларма с SNS известие
1. В CloudWatch конзолата, създайте нова аларма
2. Изберете метрика и конфигурирайте условия за алармата
3. В раздела "Actions", изберете "Send notification to an SNS topic"
4. Изберете SNS темата и кликнете "Create alarm"

## Практически проект: Система за уведомяване за събития

### Архитектура на проекта
1. Създайте SNS тема за уведомяване за събития
2. Създайте абонаменти за различни протоколи (Email, SMS, Lambda)
3. Публикувайте съобщения до темата при възникване на събития

### Стъпка 1: Създаване на SNS тема
1. В SNS конзолата, кликнете "Create topic"
2. Въведете име на темата и изберете тип (Standard)
3. Кликнете "Create topic"

### Стъпка 2: Създаване на абонаменти
1. В SNS конзолата, изберете вашата тема
2. Отидете на раздела "Subscriptions"
3. Кликнете "Create subscription"
4. Изберете протокол (Email, SMS, Lambda)
5. Въведете крайна точка (Email адрес, телефонен номер, ARN на Lambda функция)
6. Кликнете "Create subscription"

### Стъпка 3: Публикуване на съобщения
1. В SNS конзолата, изберете вашата тема
2. Кликнете "Publish message"
3. Въведете съдържание на съобщението (Subject, Message)
4. Кликнете "Publish message"

### Стъпка 4: Интеграция с Lambda
1. Създайте Lambda функция за обработка на съобщения
2. Създайте абонамент за Lambda функцията в SNS конзолата
3. Публикувайте съобщения и наблюдавайте изпълнението на Lambda функцията

### Стъпка 5: Тестване на системата
1. Публикувайте тестови съобщения до SNS темата
2. Проверете дали съобщенията се доставят до всички абонати
3. Наблюдавайте логовете и метриките за производителността на системата

## Допълнителни ресурси
- [Amazon SNS Documentation](https://docs.aws.amazon.com/sns/)
- [Amazon SNS Best Practices](https://docs.aws.amazon.com/sns/latest/dg/sns-best-practices.html)
- [AWS Lambda Documentation](https://docs.aws.amazon.com/lambda/)
- [Amazon SQS Documentation](https://docs.aws.amazon.com/sqs/)
- [Amazon CloudWatch Documentation](https://docs.aws.amazon.com/cloudwatch/)

## Въпроси за дискусия
1. Какви са предимствата на използването на SNS за уведомяване за събития?
2. Как бихте конфигурирали SNS за оптимална доставка на съобщения?
3. Какви типове приложения могат да се възползват най-много от SNS?
