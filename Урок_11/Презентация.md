# Използване на Amazon SNS за съобщения

---

## Какво ще научим днес?

- Какво е Amazon SNS и как работи
- Създаване и конфигуриране на SNS теми
- Основни функции на SNS (публикуване, абонаменти, филтриране)
- Интеграция с други AWS услуги
- Практически проект с SNS и други AWS услуги

---

## Какво е Amazon SNS?

![SNS](https://i.imgur.com/1XZtVnL.png)

Amazon Simple Notification Service (SNS) е напълно управлявана услуга за съобщения, която координира доставката на съобщения до абонати чрез различни протоколи

---

## Основни концепции на SNS

- **Теми (Topics)** - логически канали за изпращане на съобщения
- **Абонаменти (Subscriptions)** - механизми за получаване на съобщения
- **Публикуване (Publishing)** - изпращане на съобщения до теми
- **Филтриране (Filtering)** - филтриране на съобщенията
- **Протоколи** - методи за доставка на съобщения (HTTP/S, Email, SMS, Lambda)

---

## Как работи SNS?

1. Създавате SNS тема
2. Абонирате получатели
3. Публикувате съобщения
4. SNS доставя съобщения
5. Филтриране на съобщения

---

## Създаване на SNS тема

![Create SNS](https://i.imgur.com/2XZtVnL.png)

1. Отворете SNS конзолата
2. Кликнете "Create topic"
3. Въведете име на темата
4. Изберете тип на темата (Standard, FIFO)
5. Кликнете "Create topic"

---

## Конфигуриране на настройки на темата

- **Retry Policy** - политика за повторни опити
- **Delivery Status Logging** - логване на статус на доставката
- **Access Policy** - политика за достъп
- **Encryption** - криптиране на съобщенията

---

## Управление на SNS тема

![Manage SNS](https://i.imgur.com/3XZtVnL.png)

- **Създаване на абонаменти** - HTTP/S, Email, SMS, Lambda
- **Публикуване на съобщения** - изпращане на съобщения до темата
- **Филтриране на съобщения** - конфигуриране на правила за филтриране

---

## Публикуване на съобщения

### Чрез AWS Management Console
1. В SNS конзолата, изберете темата
2. Кликнете "Publish message"
3. Въведете съдържание на съобщението (Subject, Message)
4. Кликнете "Publish message"

### Чрез AWS CLI
```bash
aws sns publish \
  --topic-arn arn:aws:sns:us-east-1:123456789012:MyTopic \
  --message "Hello, this is a test message"
```

---

## Абонаменти

### Чрез AWS Management Console
1. В SNS конзолата, изберете темата
2. Отидете на "Subscriptions"
3. Кликнете "Create subscription"
4. Изберете протокол (HTTP/S, Email, SMS, Lambda)
5. Въведете крайна точка (URL, Email адрес, телефонен номер)
6. Кликнете "Create subscription"

### Чрез AWS CLI
```bash
aws sns subscribe \
  --topic-arn arn:aws:sns:us-east-1:123456789012:MyTopic \
  --protocol email \
  --notification-endpoint user@example.com
```

---

## Филтриране на съобщения

### Чрез AWS Management Console
1. В SNS конзолата, изберете темата
2. Отидете на "Subscriptions"
3. Изберете абонамент и кликнете "Edit"
4. Конфигурирайте правила за филтриране (Message Attributes)
5. Кликнете "Save changes"

### Чрез AWS CLI
```bash
aws sns set-subscription-attributes \
  --subscription-arn arn:aws:sns:us-east-1:123456789012:MyTopic:2bcfbf39-05c3-41de-beaa-fcfcc21c8f55 \
  --attribute-name FilterPolicy \
  --attribute-value '{"store":["example_corp"]}'
```

---

## Интеграция на SNS с други AWS услуги

![SNS Integration](https://i.imgur.com/4XZtVnL.png)

- **Lambda** - задействане на Lambda функции при получаване на съобщения
- **SQS** - изпращане на съобщения до SQS опашки
- **CloudWatch** - изпращане на известия до CloudWatch аларми

---

## Интеграция с Lambda

1. В SNS конзолата, изберете темата
2. Отидете на "Subscriptions"
3. Кликнете "Create subscription"
4. Изберете протокол "Lambda"
5. Въведете ARN на Lambda функцията
6. Кликнете "Create subscription"

---

## Интеграция с SQS

1. В SNS конзолата, изберете темата
2. Отидете на "Subscriptions"
3. Кликнете "Create subscription"
4. Изберете протокол "SQS"
5. Въведете ARN на SQS опашката
6. Кликнете "Create subscription"

---

## Интеграция с CloudWatch

1. В CloudWatch конзолата, създайте нова аларма
2. Изберете метрика и конфигурирайте условия за алармата
3. В раздела "Actions", изберете "Send notification to an SNS topic"
4. Изберете SNS темата и кликнете "Create alarm"

---

## Практически проект: Система за уведомяване за събития

![Project Architecture](https://i.imgur.com/5XZtVnL.png)

1. Създайте SNS тема за уведомяване за събития
2. Създайте абонаменти за различни протоколи (Email, SMS, Lambda)
3. Публикувайте съобщения до темата при възникване на събития

---

## Стъпка 1: Създаване на SNS тема

- В SNS конзолата, кликнете "Create topic"
- Въведете име на темата и изберете тип (Standard)
- Кликнете "Create topic"

---

## Стъпка 2: Създаване на абонаменти

- В SNS конзолата, изберете темата
- Отидете на "Subscriptions"
- Кликнете "Create subscription"
- Изберете протокол (Email, SMS, Lambda)
- Въведете крайна точка (Email адрес, телефонен номер, ARN на Lambda функция)
- Кликнете "Create subscription"

---

## Стъпка 3: Публикуване на съобщения

- В SNS конзолата, изберете темата
- Кликнете "Publish message"
- Въведете съдържание на съобщението (Subject, Message)
- Кликнете "Publish message"

---

## Стъпка 4: Интеграция с Lambda

- Създайте Lambda функция за обработка на съобщения
- Създайте абонамент за Lambda функцията в SNS конзолата
- Публикувайте съобщения и наблюдавайте изпълнението на Lambda функцията

---

## Стъпка 5: Тестване на системата

- Публикувайте тестови съобщения до SNS темата
- Проверете дали съобщенията се доставят до всички абонати
- Наблюдавайте логовете и метриките за производителността на системата

---

## Въпроси?

![Въпроси](https://i.imgur.com/6XZtVnL.png)
