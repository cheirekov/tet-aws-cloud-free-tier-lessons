# Използване на Amazon RDS за релационни бази данни

---

## Какво ще научим днес?

- Какво е Amazon RDS и как работи
- Създаване и конфигуриране на RDS инстанции
- Поддържани типове бази данни в RDS
- Управление на сигурността и резервните копия
- Практически проект с RDS и други AWS услуги

---

## Какво е Amazon RDS?

![RDS](https://i.imgur.com/1XZtVnL.png)

Amazon Relational Database Service (RDS) е управлявана услуга за релационни бази данни, която улеснява настройката, работата и мащабирането на релационни бази данни в облака

---

## Основни концепции на RDS

- **Инстанции** - виртуални сървъри за бази данни
- **Бази данни** - колекции от данни, организирани в таблици
- **Типове бази данни** - MySQL, PostgreSQL, MariaDB, Oracle, SQL Server
- **Сигурност** - мрежова сигурност и криптиране
- **Резервни копия** - автоматични и ръчни резервни копия
- **Мащабиране** - увеличаване или намаляване на ресурсите

---

## Как работи RDS?

1. Създавате RDS инстанция
2. Свързвате се с базата данни
3. Управлявате базата данни
4. Осигурявате сигурност
5. Архивирате данни
6. Мащабирате ресурси

---

## Създаване на RDS инстанция

![Create RDS](https://i.imgur.com/2XZtVnL.png)

1. Отворете RDS конзолата
2. Кликнете "Create database"
3. Изберете тип база данни
4. Конфигурирайте настройки на инстанцията
5. Кликнете "Create database"

---

## Конфигуриране на настройки на инстанцията

- **Шаблон** - Production, Dev/Test, Free tier
- **Тип на инстанцията** - db.t2.micro за Free Tier
- **Съхранение** - General Purpose SSD
- **Multi-AZ разполагане** - опционално
- **Мрежа и сигурност** - VPC, subnet, security group
- **Идентификация и достъп** - потребителско име и парола
- **Допълнителни настройки** - Backup, Monitoring, Maintenance, Encryption

---

## Управление на RDS инстанция

![Manage RDS](https://i.imgur.com/3XZtVnL.png)

- **Свързване с базата данни** - използвайте предоставената информация (endpoint, порт, потребителско име, парола)
- **Изпълнение на SQL заявки** - създаване на таблици, вмъкване на данни, актуализиране и изтриване на данни
- **Управление на сигурността** - мрежова сигурност, потребители и роли, криптиране на данните
- **Архивиране и възстановяване на данни** - автоматични и ръчни резервни копия
- **Мащабиране на ресурси** - промяна на типа на инстанцията или капацитета на съхранение

---

## Поддържани типове бази данни в RDS

![Database Types](https://i.imgur.com/4XZtVnL.png)

- **MySQL** - популярна отворена база данни
- **PostgreSQL** - мощна отворена база данни с разширени функции
- **MariaDB** - форк на MySQL с допълнителни функции
- **Oracle** - комерсиална база данни с висока производителност
- **SQL Server** - комерсиална база данни от Microsoft

---

## Избор на подходящ тип база данни

- **Изисквания на приложението** - специфични функции и разширения
- **Производителност и мащабируемост** - способността на базата данни да се справя с натоварването
- **Съвместимост** - съвместимост с други компоненти на приложението
- **Лицензиране и разходи** - разходи за лицензиране и поддръжка

---

## Практически проект: Система за управление на потребители

![Архитектура](https://i.imgur.com/5XZtVnL.png)

1. Потребителят създава акаунт чрез уеб интерфейс
2. Данните за потребителя се записват в RDS база данни
3. Потребителят може да преглежда, актуализира и изтрива акаунта си

---

## Стъпка 1: Създаване на RDS инстанция

- Създайте RDS инстанция с MySQL база данни
- Изберете Free Tier опции (db.t2.micro, 20 GB General Purpose SSD)
- Конфигурирайте мрежова сигурност (VPC, subnet, security group)
- Задайте потребителско име и парола за администратора

---

## Стъпка 2: Създаване на IAM роля

Разрешения:
- `AWSLambdaBasicExecutionRole`
- `AmazonRDSFullAccess`

---

## Стъпка 3: Създаване на Lambda функции

### Функция за създаване на потребител (Node.js)

```javascript
const mysql = require('mysql');
const connection = mysql.createConnection({
    host: process.env.DB_HOST,
    user: process.env.DB_USER,
    password: process.env.DB_PASSWORD,
    database: process.env.DB_NAME
});

exports.handler = async (event) => {
    const { username, email, password } = JSON.parse(event.body);
    
    const query = 'INSERT INTO users (username, email, password) VALUES (?, ?, ?)';
    const values = [username, email, password];
    
    return new Promise((resolve, reject) => {
        connection.query(query, values, (error, results) => {
            if (error) {
                console.error('Error inserting user:', error);
                reject({
                    statusCode: 500,
                    body: JSON.stringify({ message: 'Error inserting user' })
                });
            } else {
                resolve({
                    statusCode: 201,
                    body: JSON.stringify({ message: 'User created', userId: results.insertId })
                });
            }
        });
    });
};
```

---

## Функция за четене на потребители (Node.js)

```javascript
const mysql = require('mysql');
const connection = mysql.createConnection({
    host: process.env.DB_HOST,
    user: process.env.DB_USER,
    password: process.env.DB_PASSWORD,
    database: process.env.DB_NAME
});

exports.handler = async (event) => {
    const query = 'SELECT * FROM users';
    
    return new Promise((resolve, reject) => {
        connection.query(query, (error, results) => {
            if (error) {
                console.error('Error fetching users:', error);
                reject({
                    statusCode: 500,
                    body: JSON.stringify({ message: 'Error fetching users' })
                });
            } else {
                resolve({
                    statusCode: 200,
                    body: JSON.stringify(results)
                });
            }
        });
    });
};
```

---

## Функция за актуализиране на потребител (Node.js)

```javascript
const mysql = require('mysql');
const connection = mysql.createConnection({
    host: process.env.DB_HOST,
    user: process.env.DB_USER,
    password: process.env.DB_PASSWORD,
    database: process.env.DB_NAME
});

exports.handler = async (event) => {
    const { userId, username, email, password } = JSON.parse(event.body);
    
    const query = 'UPDATE users SET username = ?, email = ?, password = ? WHERE id = ?';
    const values = [username, email, password, userId];
    
    return new Promise((resolve, reject) => {
        connection.query(query, values, (error, results) => {
            if (error) {
                console.error('Error updating user:', error);
                reject({
                    statusCode: 500,
                    body: JSON.stringify({ message: 'Error updating user' })
                });
            } else {
                resolve({
                    statusCode: 200,
                    body: JSON.stringify({ message: 'User updated' })
                });
            }
        });
    });
};
```

---

## Функция за изтриване на потребител (Node.js)

```javascript
const mysql = require('mysql');
const connection = mysql.createConnection({
    host: process.env.DB_HOST,
    user: process.env.DB_USER,
    password: process.env.DB_PASSWORD,
    database: process.env.DB_NAME
});

exports.handler = async (event) => {
    const { userId } = JSON.parse(event.body);
    
    const query = 'DELETE FROM users WHERE id = ?';
    const values = [userId];
    
    return new Promise((resolve, reject) => {
        connection.query(query, values, (error, results) => {
            if (error) {
                console.error('Error deleting user:', error);
                reject({
                    statusCode: 500,
                    body: JSON.stringify({ message: 'Error deleting user' })
                });
            } else {
                resolve({
                    statusCode: 200,
                    body: JSON.stringify({ message: 'User deleted' })
                });
            }
        });
    });
};
```

---

## Стъпка 4: Пакетиране на Lambda функции

```bash
mkdir create-user && cd create-user
npm init -y
npm install mysql
# Създайте index.js с кода на функцията
zip -r function.zip index.js node_modules
```

---

## Стъпка 5: Създаване на Lambda функции

1. Създайте функции за създаване, четене, актуализиране и изтриване на потребители
2. Качете ZIP файловете
3. Задайте `index.handler` като handler
4. Изберете IAM ролята
5. Увеличете timeout и памет

---

## Стъпка 6: Създаване на API Gateway

1. Създайте нов REST API
2. Създайте ресурси и методи за създаване, четене, актуализиране и изтриване на потребители
3. Интегрирайте методите с Lambda функциите

---

## Стъпка 7: Тестване на системата

1. Използвайте Postman или друг инструмент за тестване на API
2. Създайте, прочетете, актуализирайте и изтрийте потребители
3. Проверете данните в RDS базата данни

---

## Въпроси?

![Въпроси](https://i.imgur.com/6XZtVnL.png)
