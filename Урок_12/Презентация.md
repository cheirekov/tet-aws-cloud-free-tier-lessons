# Използване на Amazon SQS за опашки за съобщения

---

## Какво ще научим днес?

- Какво е Amazon SQS и как работи
- Създаване и конфигуриране на SQS опашки
- Основни функции на SQS (изпращане, получаване, изтриване на съобщения)
- Интеграция с други AWS услуги
- Практически проект с SQS и други AWS услуги

---

## Какво е Amazon SQS?

![SQS](https://i.imgur.com/1XZtVnL.png)

Amazon Simple Queue Service (SQS) е напълно управлявана услуга за опашки за съобщения, която позволява изпращане, съхранение и получаване на съобщения между софтуерни компоненти

---

## Основни концепции на SQS

- **Опашки (Queues)** - контейнери за съобщения
- **Съобщения (Messages)** - единици данни
- **Изпращане (Sending)** - добавяне на съобщения в опашката
- **Получаване (Receiving)** - извличане на съобщения от опашката
- **Изтриване (Deleting)** - премахване на съобщения след обработка
- **Видове опашки** - Standard и FIFO (First-In-First-Out)

---

## Как работи SQS?

1. Създавате SQS опашка
2. Изпращате съобщения
3. Получавате съобщения
4. Изтривате съобщения
5. Управлявате опашката

---

## Създаване на SQS опашка

![Create SQS](https://i.imgur.com/2XZtVnL.png)

1. Отворете SQS конзолата
2. Кликнете "Create queue"
3. Изберете тип опашка (Standard или FIFO)
4. Въведете име на опашката
5. Конфигурирайте основни настройки
6. Кликнете "Create Queue"

---

## Конфигуриране на настройки на опашката

- **Visibility Timeout** - време, през което съобщението е невидимо след получаване
- **Message Retention Period** - период на съхранение на съобщенията
- **Maximum Message Size** - максимален размер на съобщението
- **Delivery Delay** - забавяне на доставката на съобщенията
- **Access Policy** - политика за достъп
- **Encryption** - криптиране на съобщенията

---

## Управление на SQS опашка

![Manage SQS](https://i.imgur.com/3XZtVnL.png)

- **Изпращане на съобщения** - добавяне на съобщения в опашката
- **Получаване на съобщения** - извличане на съобщения от опашката
- **Изтриване на съобщения** - премахване на съобщения след обработка

---

## Изпращане на съобщения

### Чрез AWS Management Console
1. В SQS конзолата, изберете опашката
2. Кликнете "Send and receive messages"
3. Въведете съдържание на съобщението
4. Кликнете "Send message"

### Чрез AWS CLI
```bash
aws sqs send-message \
  --queue-url https://sqs.us-east-1.amazonaws.com/123456789012/MyQueue \
  --message-body "Hello, this is a test message"
```

---

## Получаване на съобщения

### Чрез AWS Management Console
1. В SQS конзолата, изберете опашката
2. Кликнете "Send and receive messages"
3. Кликнете "Poll for messages"
4. Прегледайте получените съобщения

### Чрез AWS CLI
```bash
aws sqs receive-message \
  --queue-url https://sqs.us-east-1.amazonaws.com/123456789012/MyQueue
```

---

## Изтриване на съобщения

### Чрез AWS Management Console
1. В SQS конзолата, изберете опашката
2. Кликнете "Send and receive messages"
3. Изберете съобщение и кликнете "Delete"

### Чрез AWS CLI
```bash
aws sqs delete-message \
  --queue-url https://sqs.us-east-1.amazonaws.com/123456789012/MyQueue \
  --receipt-handle AQEBwJnKyrHigUMZj6rYigCgxlaS3SLy0a...
```

---

## Интеграция на SQS с други AWS услуги

![SQS Integration](https://i.imgur.com/4XZtVnL.png)

- **Lambda** - задействане на Lambda функции при получаване на съобщения
- **SNS** - получаване на съобщения от SNS теми
- **CloudWatch** - изпращане на метрики до CloudWatch

---

## Интеграция с Lambda

1. В Lambda конзолата, изберете функцията
2. Отидете на "Configuration" > "Triggers"
3. Кликнете "Add trigger"
4. Изберете "SQS" като източник на тригера
5. Въведете URL на SQS опашката
6. Кликнете "Add"

---

## Интеграция с SNS

1. В SNS конзолата, изберете темата
2. Отидете на "Subscriptions"
3. Кликнете "Create subscription"
4. Изберете протокол "SQS"
5. Въведете URL на SQS опашката
6. Кликнете "Create subscription"

---

## Интеграция с CloudWatch

1. В CloudWatch конзолата, изберете "Metrics"
2. Изберете "SQS" като източник на метриките
3. Прегледайте метриките за опашката (NumberOfMessagesSent, NumberOfMessagesReceived, NumberOfMessagesDeleted)

---

## Практически проект: Система за обработка на задачи

![Project Architecture](https://i.imgur.com/5XZtVnL.png)

1. Създайте SQS опашка за задачи
2. Създайте Lambda функция за обработка на задачи
3. Създайте тригер за Lambda функцията от SQS опашката
4. Изпращайте задачи до SQS опашката и наблюдавайте обработката им

---

## Стъпка 1: Създаване на SQS опашка

- В SQS конзолата, кликнете "Create queue"
- Въведете име на опашката и изберете тип (Standard)
- Конфигурирайте основни настройки и кликнете "Create Queue"

---

## Стъпка 2: Създаване на Lambda функция

### Функция за обработка на задачи (Node.js)

```javascript
exports.handler = async (event) => {
    for (const record of event.Records) {
        const messageBody = record.body;
        console.log('Processing task:', messageBody);
        
        // Вашата логика за обработка на задачата тук
        
        console.log('Task processed successfully');
    }
};
```

---

## Стъпка 3: Създаване на тригер за Lambda функцията

- В Lambda конзолата, изберете функцията
- Отидете на "Configuration" > "Triggers"
- Кликнете "Add trigger"
- Изберете "SQS" като източник на тригера
- Въведете URL на SQS опашката
- Кликнете "Add"

---

## Стъпка 4: Изпращане на задачи до SQS опашката

- В SQS конзолата, изберете опашката
- Кликнете "Send and receive messages"
- Въведете съдържание на задачата и кликнете "Send message"

---

## Стъпка 5: Тестване на системата

- Изпратете тестови задачи до SQS опашката
- Проверете логовете на Lambda функцията в CloudWatch
- Уверете се, че задачите се обработват правилно

---

## Въпроси?

![Въпроси](https://i.imgur.com/6XZtVnL.png)
