# Урок 5: Създаване и конфигуриране на EC2 инстанция

## Цели на урока
- Да разберем какво е EC2 и как работи
- Да се научим да създаваме и конфигурираме EC2 инстанции
- Да се запознаем с различните типове инстанции и AMI (Amazon Machine Images)
- Да се научим да се свързваме с EC2 инстанции чрез SSH
- Да разберем как да управляваме сигурността на EC2 инстанции чрез Security Groups

## Какво е EC2 и как работи?

### Дефиниция на EC2
Amazon Elastic Compute Cloud (EC2) е уеб услуга, която предоставя сигурен, преоразмеряем изчислителен капацитет в облака. Тя е проектирана да улесни разработчиците да използват изчислителни ресурси в облака в мащаб.

### Основни концепции на EC2
- **Инстанции** - виртуални сървъри, които можете да стартирате в облака
- **AMI (Amazon Machine Images)** - предварително конфигурирани шаблони за вашите инстанции
- **Типове инстанции** - различни конфигурации на CPU, памет, съхранение и мрежови възможности
- **Ключови двойки** - сигурен начин за достъп до вашите инстанции
- **Security Groups** - виртуални защитни стени, които контролират трафика към и от вашите инстанции
- **Elastic IP** - статични IPv4 адреси, проектирани за динамично облачно изчисление
- **EBS (Elastic Block Store)** - постоянно блоково съхранение за вашите инстанции

### Как работи EC2?
1. **Избирате AMI** - операционна система и софтуер
2. **Избирате тип инстанция** - хардуерна конфигурация
3. **Конфигурирате мрежови настройки** - VPC, subnet, IP адреси
4. **Конфигурирате съхранение** - EBS обеми или инстанс съхранение
5. **Конфигурирате Security Group** - правила за достъп
6. **Стартирате инстанцията** - инстанцията се създава и стартира
7. **Свързвате се с инстанцията** - чрез SSH (Linux) или RDP (Windows)
8. **Използвате инстанцията** - инсталирате софтуер, изпълнявате приложения
9. **Наблюдавате инстанцията** - следите производителността и използването
10. **Прекратявате инстанцията** - когато вече не ви е необходима

## Типове EC2 инстанции

EC2 предлага различни типове инстанции, оптимизирани за различни случаи на употреба. Всеки тип инстанция включва една или повече размери на инстанции, което ви позволява да мащабирате ресурсите според нуждите на вашето приложение.

### Основни категории инстанции
- **General Purpose (T, M)** - балансирани ресурси, подходящи за разнообразни работни натоварвания
- **Compute Optimized (C)** - високопроизводителни процесори, идеални за изчислително интензивни приложения
- **Memory Optimized (R, X, z)** - бърза производителност за работни натоварвания, обработващи големи набори от данни в паметта
- **Storage Optimized (D, I, H)** - високи IOPS за работни натоварвания, изискващи високоскоростен достъп до данни
- **Accelerated Computing (P, G, F)** - хардуерни ускорители или копроцесори за специфични функции

### Free Tier инстанции
AWS Free Tier включва 750 часа месечно на t2.micro или t3.micro инстанции (за първите 12 месеца). Това е еквивалентно на една инстанция, работеща непрекъснато през целия месец.

#### t2.micro / t3.micro спецификации:
- 1 vCPU
- 1 GB RAM
- Променлива EBS пропускателна способност
- Подходящи за: разработка, тестване, микро услуги, уеб сървъри с нисък трафик

## Amazon Machine Images (AMI)

AMI предоставя информацията, необходима за стартиране на инстанция. Тя включва:
- Операционна система
- Приложен сървър (опционално)
- Приложения (опционално)

### Типове AMI
1. **Публични AMI** - предоставени от AWS (Amazon Linux, Ubuntu, Windows и др.)
2. **Собствени AMI** - създадени и поддържани от вас
3. **AWS Marketplace AMI** - предоставени от трети страни, често включват лицензиран софтуер
4. **Общностни AMI** - създадени и споделени от общността на AWS

### Избор на подходящ AMI
При избора на AMI, обмислете:
- Операционна система (Linux, Windows)
- Архитектура (32-bit, 64-bit, ARM)
- Регион (AMI са специфични за региона)
- Съхранение (EBS или инстанс съхранение)
- Допълнителен софтуер и конфигурации

## Създаване на EC2 инстанция

### Стъпки за създаване на EC2 инстанция чрез AWS Management Console

#### 1. Отворете EC2 Dashboard
1. Влезте в AWS Management Console
2. Отидете на услугата "EC2"
3. Кликнете "Launch instance" в секцията "Launch instance"

#### 2. Изберете AMI
1. Изберете AMI от списъка (например Amazon Linux 2, Ubuntu, Windows)
2. Обърнете внимание на "Free tier eligible" етикета

#### 3. Изберете тип инстанция
1. Изберете тип инстанция (например t2.micro за Free Tier)
2. Кликнете "Next: Configure Instance Details"

#### 4. Конфигурирайте детайлите на инстанцията
1. Изберете VPC и subnet
2. Оставете "Auto-assign Public IP" на "Enable"
3. Конфигурирайте IAM роля (опционално)
4. Конфигурирайте User data (опционално) - скриптове, които се изпълняват при стартиране
5. Кликнете "Next: Add Storage"

#### 5. Добавете съхранение
1. Конфигурирайте размера на EBS обема (по подразбиране 8 GB)
2. Изберете тип на обема (gp2 е подходящ за повечето случаи)
3. Кликнете "Next: Add Tags"

#### 6. Добавете тагове (опционално)
1. Кликнете "Add Tag"
2. Въведете ключ (например "Name") и стойност (например "WebServer")
3. Кликнете "Next: Configure Security Group"

#### 7. Конфигурирайте Security Group
1. Създайте нов Security Group или изберете съществуващ
2. Добавете правила за входящ трафик:
   - SSH (порт 22) от вашия IP адрес
   - HTTP (порт 80) от всички (0.0.0.0/0) ако е уеб сървър
   - HTTPS (порт 443) от всички (0.0.0.0/0) ако е уеб сървър с SSL
3. Кликнете "Review and Launch"

#### 8. Преглед и стартиране
1. Прегледайте всички настройки
2. Кликнете "Launch"

#### 9. Създайте или изберете ключова двойка
1. Изберете "Create a new key pair" или използвайте съществуваща
2. Въведете име на ключовата двойка (ако създавате нова)
3. Изтеглете ключовата двойка (ако създавате нова)
4. Кликнете "Launch Instances"

#### 10. Преглед на статуса на инстанцията
1. Кликнете "View Instances" за да видите статуса на вашата инстанция
2. Изчакайте статусът да стане "running" и проверките да преминат

## Свързване с EC2 инстанция

### Свързване с Linux инстанция чрез SSH

#### Предварителни изисквания
- Инстанцията трябва да е в състояние "running"
- Трябва да имате .pem файла с частния ключ
- Security Group трябва да позволява SSH достъп от вашия IP адрес

#### Стъпки за свързване от Linux/macOS
1. Отворете терминал
2. Задайте правилни разрешения на ключовия файл:
   ```bash
   chmod 400 your-key.pem
   ```
3. Свържете се с инстанцията:
   ```bash
   ssh -i your-key.pem ec2-user@your-instance-public-ip
   ```
   Забележка: Потребителското име зависи от AMI:
   - Amazon Linux: ec2-user
   - Ubuntu: ubuntu
   - RHEL: ec2-user или root
   - Debian: admin или root
   - CentOS: centos или root

#### Стъпки за свързване от Windows с PuTTY
1. Изтеглете и инсталирайте PuTTY и PuTTYgen
2. Използвайте PuTTYgen за да конвертирате .pem файла в .ppk:
   - Стартирайте PuTTYgen
   - Кликнете "Load" и изберете вашия .pem файл
   - Кликнете "Save private key" и запазете .ppk файла
3. Стартирайте PuTTY и конфигурирайте сесията:
   - В полето "Host Name", въведете: ec2-user@your-instance-public-ip
   - В навигацията вляво, отидете на Connection > SSH > Auth
   - Кликнете "Browse" и изберете вашия .ppk файл
   - Върнете се на "Session", въведете име в "Saved Sessions" и кликнете "Save"
   - Кликнете "Open" за да се свържете

### Свързване с Windows инстанция чрез RDP

#### Предварителни изисквания
- Инстанцията трябва да е в състояние "running"
- Трябва да имате .pem файла с частния ключ
- Security Group трябва да позволява RDP достъп (порт 3389) от вашия IP адрес

#### Стъпки за свързване
1. В EC2 конзолата, изберете вашата Windows инстанция
2. Кликнете "Connect"
3. Изберете "RDP client"
4. Кликнете "Get Password"
5. Кликнете "Browse" и изберете вашия .pem файл
6. Кликнете "Decrypt Password" за да получите паролата за администратор
7. Запазете или копирайте паролата
8. Използвайте RDP клиент:
   - Windows: Remote Desktop Connection
   - macOS: Microsoft Remote Desktop
   - Linux: Remmina или други RDP клиенти
9. Въведете публичния DNS или IP адрес на инстанцията
10. Въведете потребителско име "Administrator" и паролата, която получихте

## Security Groups

Security Groups действат като виртуална защитна стена за вашите инстанции, контролирайки входящия и изходящия трафик.

### Ключови характеристики на Security Groups
- Действат на ниво инстанция (не на ниво subnet)
- Поддържат само правила за разрешаване (не можете изрично да забраните трафик)
- Stateful (ако изпратите заявка, отговорът е разрешен независимо от правилата за изходящ трафик)
- Можете да добавяте и премахвате правила по всяко време (промените се прилагат незабавно)

### Създаване на Security Group
1. В EC2 конзолата, отидете на "Security Groups" в навигационното меню вляво
2. Кликнете "Create security group"
3. Въведете име и описание
4. Изберете VPC
5. Добавете правила за входящ трафик:
   - Тип: SSH, HTTP, HTTPS и т.н.
   - Протокол: TCP, UDP, ICMP
   - Порт: 22 (SSH), 80 (HTTP), 443 (HTTPS) и т.н.
   - Източник: IP адрес, CIDR блок, друг Security Group
6. Добавете правила за изходящ трафик (по подразбиране всичко е разрешено)
7. Добавете тагове (опционално)
8. Кликнете "Create security group"

### Управление на Security Groups
1. **Редактиране на правила**:
   - Изберете Security Group
   - Кликнете "Edit inbound rules" или "Edit outbound rules"
   - Добавете, променете или премахнете правила
   - Кликнете "Save rules"

2. **Присвояване на Security Group към инстанция**:
   - Изберете инстанцията
   - Кликнете "Actions" > "Security" > "Change security groups"
   - Изберете желаните Security Groups
   - Кликнете "Save"

### Най-добри практики за Security Groups
1. **Следвайте принципа на най-малките привилегии** - разрешете само необходимия трафик
2. **Ограничете SSH достъпа** - разрешете SSH само от конкретни IP адреси
3. **Използвайте отделни Security Groups за различни функции** - уеб сървър, база данни и т.н.
4. **Използвайте тагове** - за по-лесно идентифициране и управление
5. **Редовно преглеждайте и актуализирайте правилата** - премахвайте ненужните правила

## Управление на EC2 инстанции

### Стартиране и спиране на инстанции
1. В EC2 конзолата, изберете инстанцията
2. Кликнете "Instance state" и изберете:
   - **Start** - стартира спряна инстанция
   - **Stop** - спира инстанцията (данните на EBS обемите се запазват)
   - **Hibernate** - хибернира инстанцията (запазва RAM съдържанието)
   - **Reboot** - рестартира инстанцията
   - **Terminate** - прекратява инстанцията (данните на EBS обемите се изтриват по подразбиране)

### Мониторинг на инстанции
1. В EC2 конзолата, изберете инстанцията
2. Отидете на раздела "Monitoring"
3. Прегледайте метриките:
   - CPU Utilization
   - Network In/Out
   - Disk Read/Write
   - Status Checks
4. Кликнете "Manage detailed monitoring" за да активирате подробен мониторинг (с такса)

### Създаване на AMI от съществуваща инстанция
1. В EC2 конзолата, изберете инстанцията
2. Кликнете "Actions" > "Image and templates" > "Create image"
3. Въведете име и описание
4. Конфигурирайте опциите за обемите
5. Кликнете "Create image"
6. Отидете на "AMIs" в навигационното меню вляво за да видите статуса на вашия AMI

## Практическа задача: Създаване и конфигуриране на EC2 инстанция

### Задача 1: Създаване на EC2 инстанция
1. Създайте EC2 инстанция със следните параметри:
   - AMI: Amazon Linux 2
   - Тип инстанция: t2.micro (Free Tier)
   - Име: "WebServer"
   - Security Group: Разрешете SSH (порт 22) от вашия IP и HTTP (порт 80) от всички
   - Ключова двойка: Създайте нова или използвайте съществуваща

### Задача 2: Свързване с инстанцията
1. Свържете се с инстанцията чрез SSH
2. Проверете системната информация:
   ```bash
   cat /etc/os-release
   uname -a
   free -h
   df -h
   ```

### Задача 3: Инсталиране на уеб сървър
1. Актуализирайте пакетите:
   ```bash
   sudo yum update -y
   ```
2. Инсталирайте Apache уеб сървър:
   ```bash
   sudo yum install -y httpd
   ```
3. Стартирайте Apache и го настройте да стартира автоматично:
   ```bash
   sudo systemctl start httpd
   sudo systemctl enable httpd
   ```
4. Създайте проста уеб страница:
   ```bash
   sudo bash -c 'echo "<html><body><h1>Hello from AWS EC2!</h1></body></html>" > /var/www/html/index.html'
   ```
5. Отворете публичния IP адрес на инстанцията в уеб браузър за да проверите дали уеб сървърът работи

### Задача 4: Създаване на AMI
1. Създайте AMI от вашата инстанция
2. Дайте на AMI име "WebServerAMI" и подходящо описание

### Задача 5: Стартиране на втора инстанция от вашия AMI
1. Стартирайте нова инстанция, използвайки вашия "WebServerAMI"
2. Проверете дали уеб сървърът работи на новата инстанция

## Допълнителни ресурси
- [Amazon EC2 Documentation](https://docs.aws.amazon.com/ec2/)
- [Amazon EC2 Instance Types](https://aws.amazon.com/ec2/instance-types/)
- [Amazon EC2 Pricing](https://aws.amazon.com/ec2/pricing/)
- [Amazon EC2 Best Practices](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-best-practices.html)
- [Amazon EC2 Security Groups](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-security-groups.html)

## Въпроси за дискусия
1. Какви са предимствата на използването на EC2 инстанции спрямо традиционните сървъри?
2. Как бихте избрали подходящ тип инстанция за вашето приложение?
3. Какви мерки за сигурност бихте предприели за защита на вашите EC2 инстанции?
