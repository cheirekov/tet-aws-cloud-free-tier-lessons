# Урок 10: Използване на Amazon CloudFront за доставка на съдържание

## Цели на урока
- Да разберем какво е Amazon CloudFront и как работи
- Да се научим да създаваме и конфигурираме CloudFront дистрибуции
- Да се запознаем с основните функции на CloudFront (кеширане, сигурност, мониторинг)
- Да разберем как да интегрираме CloudFront с други AWS услуги
- Да създадем прост проект, използвайки CloudFront и други AWS услуги

## Какво е Amazon CloudFront и как работи?

### Дефиниция на Amazon CloudFront
Amazon CloudFront е глобална мрежа за доставка на съдържание (CDN), която ускорява доставката на вашите уебсайтове, API, видео съдържание и други уеб активи до вашите потребители. CloudFront интегрира с други AWS услуги, като S3, EC2 и Lambda, за да предостави сигурно и бързо съдържание.

### Основни концепции на CloudFront
- **Дистрибуции** - конфигурации, които определят как CloudFront доставя съдържание.
- **Origins** - източници на съдържание, които CloudFront доставя (например S3 bucket, EC2 инстанция, HTTP сървър).
- **Edge Locations** - глобални точки за присъствие, където CloudFront кешира съдържание.
- **Кеширане** - съхранение на копия на съдържание в Edge Locations за бърз достъп.
- **Сигурност** - механизми за защита на съдържанието, включително SSL/TLS, подписани URL адреси и заглавия.
- **Мониторинг** - наблюдение на производителността и използването на CloudFront дистрибуции.

### Как работи CloudFront?
1. **Създавате CloudFront дистрибуция** - конфигурирате дистрибуцията и определяте източниците на съдържание.
2. **Качвате съдържание в източника** - качвате файлове в S3 bucket или друг източник.
3. **Потребителите заявяват съдържание** - потребителите правят заявки за съдържание чрез CloudFront дистрибуцията.
4. **CloudFront доставя съдържание** - CloudFront доставя съдържание от най-близката Edge Location или от източника, ако съдържанието не е кеширано.
5. **Кеширане на съдържание** - CloudFront кешира съдържание в Edge Locations за бъдещи заявки.
6. **Мониторинг и управление** - наблюдавате производителността и използването на дистрибуцията и правите промени при нужда.

## Създаване и конфигуриране на CloudFront дистрибуция

### Стъпки за създаване на CloudFront дистрибуция чрез AWS Management Console

#### 1. Отворете CloudFront конзолата
1. Влезте в AWS Management Console
2. Отидете на услугата "CloudFront"
3. Кликнете "Create distribution"

#### 2. Изберете тип дистрибуция
1. Изберете "Web" за уеб съдържание или "RTMP" за стрийминг на медийно съдържание
2. Кликнете "Get Started"

#### 3. Конфигурирайте настройки на дистрибуцията
1. Въведете източник на съдържание (например S3 bucket, EC2 инстанция, HTTP сървър)
2. Конфигурирайте настройки за кеширане:
   - **Default TTL** - време за живот на кеша по подразбиране
   - **Max TTL** - максимално време за живот на кеша
   - **Min TTL** - минимално време за живот на кеша
3. Конфигурирайте настройки за сигурност:
   - **SSL/TLS** - активирайте HTTPS за сигурна доставка на съдържание
   - **Signed URLs and Cookies** - използвайте подписани URL адреси и бисквитки за контрол на достъпа
4. Конфигурирайте настройки за мониторинг:
   - **Logging** - активирайте логване на заявки в S3 bucket
   - **CloudWatch Metrics** - активирайте CloudWatch метрики за наблюдение на производителността
5. Конфигурирайте допълнителни настройки (опционално):
   - **Custom Error Pages** - създайте персонализирани страници за грешки
   - **Geo Restriction** - ограничете достъпа до съдържание по географски региони
6. Кликнете "Create distribution"

### Управление на CloudFront дистрибуция

#### Качване на съдържание в източника
1. Качете файлове в S3 bucket или друг източник на съдържание
2. Уверете се, че файловете са публично достъпни или конфигурирайте подходящи разрешения

#### Достъп до съдържание чрез CloudFront
1. Използвайте предоставения CloudFront домейн (например `d123456abcdef8.cloudfront.net`) за достъп до съдържанието
2. Заменете оригиналния URL адрес на съдържанието с CloudFront домейна

#### Управление на кеша
1. В CloudFront конзолата, изберете вашата дистрибуция
2. Отидете на раздела "Invalidations"
3. Кликнете "Create Invalidation"
4. Въведете пътищата на файловете, които искате да изчистите от кеша (например `/index.html`)
5. Кликнете "Invalidate"

#### Мониторинг на производителността
1. В CloudFront конзолата, изберете вашата дистрибуция
2. Отидете на раздела "Monitoring"
3. Прегледайте CloudWatch метриките за заявки, латентност, грешки и други показатели
4. Конфигурирайте аларми в CloudWatch за важни метрики

## Основни функции на CloudFront

### Кеширане
CloudFront кешира съдържание в Edge Locations за бърз достъп до потребителите. Кеширането намалява натоварването на източника и подобрява производителността.

#### Конфигуриране на кеширане
1. В CloudFront конзолата, изберете вашата дистрибуция
2. Отидете на раздела "Behaviors"
3. Изберете поведение (behavior) и кликнете "Edit"
4. Конфигурирайте настройки за кеширане (TTL, кеширане на заглавия и бисквитки)
5. Кликнете "Save changes"

### Сигурност
CloudFront предоставя различни механизми за защита на съдържанието, включително SSL/TLS, подписани URL адреси и заглавия, и географски ограничения.

#### Активиране на SSL/TLS
1. В CloudFront конзолата, изберете вашата дистрибуция
2. Отидете на раздела "General"
3. Кликнете "Edit"
4. Изберете "Viewer Protocol Policy" (например "Redirect HTTP to HTTPS")
5. Кликнете "Save changes"

#### Използване на подписани URL адреси и бисквитки
1. Създайте CloudFront ключови двойки (key pairs) в AWS Management Console
2. Използвайте AWS SDK или инструменти за генериране на подписани URL адреси и бисквитки
3. Конфигурирайте вашето приложение да използва подписани URL адреси и бисквитки за контрол на достъпа

### Мониторинг
CloudFront интегрира с Amazon CloudWatch за наблюдение на производителността и използването на дистрибуциите.

#### Активиране на логване
1. В CloudFront конзолата, изберете вашата дистрибуция
2. Отидете на раздела "General"
3. Кликнете "Edit"
4. Активирайте "Logging" и изберете S3 bucket за съхранение на логовете
5. Кликнете "Save changes"

#### Преглед на CloudWatch метрики
1. В CloudFront конзолата, изберете вашата дистрибуция
2. Отидете на раздела "Monitoring"
3. Прегледайте CloudWatch метриките за заявки, латентност, грешки и други показатели

## Интеграция на CloudFront с други AWS услуги

### Интеграция със S3
CloudFront може да доставя съдържание директно от S3 bucket, което осигурява бърза и сигурна доставка на статични файлове.

#### Конфигуриране на S3 като източник
1. В CloudFront конзолата, създайте нова дистрибуция
2. Изберете S3 bucket като източник на съдържание
3. Конфигурирайте настройки за кеширане и сигурност
4. Кликнете "Create distribution"

### Интеграция с EC2
CloudFront може да доставя съдържание от EC2 инстанции, което осигурява бърза и сигурна доставка на динамични уеб приложения.

#### Конфигуриране на EC2 като източник
1. В CloudFront конзолата, създайте нова дистрибуция
2. Изберете EC2 инстанция като източник на съдържание
3. Конфигурирайте настройки за кеширане и сигурност
4. Кликнете "Create distribution"

### Интеграция с Lambda@Edge
Lambda@Edge позволява изпълнение на Lambda функции в Edge Locations, което осигурява персонализиране на съдържанието и обработка на заявки близо до потребителите.

#### Създаване на Lambda@Edge функция
1. Създайте Lambda функция в AWS Management Console
2. Деплойте функцията в Edge Locations чрез Lambda@Edge
3. Конфигурирайте CloudFront дистрибуцията да използва Lambda@Edge функцията за обработка на заявки

## Практически проект: Създаване на статичен уебсайт с CloudFront и S3

### Архитектура на проекта
1. Качете статични файлове (HTML, CSS, JavaScript) в S3 bucket
2. Създайте CloudFront дистрибуция за доставяне на съдържанието от S3 bucket
3. Конфигурирайте кеширане, сигурност и мониторинг

### Стъпка 1: Създаване на S3 bucket
1. Създайте S3 bucket за съхранение на статичните файлове
2. Качете файловете (index.html, styles.css, script.js) в S3 bucket
3. Уверете се, че файловете са публично достъпни

### Стъпка 2: Създаване на CloudFront дистрибуция
1. В CloudFront конзолата, създайте нова дистрибуция
2. Изберете S3 bucket като източник на съдържание
3. Конфигурирайте настройки за кеширане и сигурност
4. Кликнете "Create distribution"

### Стъпка 3: Конфигуриране на кеширане и сигурност
1. В CloudFront конзолата, изберете вашата дистрибуция
2. Отидете на раздела "Behaviors" и конфигурирайте настройки за кеширане
3. Отидете на раздела "General" и активирайте SSL/TLS за сигурна доставка на съдържание

### Стъпка 4: Мониторинг на производителността
1. В CloudFront конзолата, изберете вашата дистрибуция
2. Отидете на раздела "Monitoring" и активирайте CloudWatch метрики
3. Прегледайте метриките за заявки, латентност и грешки

### Стъпка 5: Тестване на уебсайта
1. Използвайте предоставения CloudFront домейн за достъп до уебсайта
2. Проверете дали съдържанието се доставя правилно и бързо
3. Направете промени в съдържанието и изчистете кеша при нужда

## Допълнителни ресурси
- [Amazon CloudFront Documentation](https://docs.aws.amazon.com/cloudfront/)
- [Amazon CloudFront Best Practices](https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/best-practices.html)
- [AWS S3 Documentation](https://docs.aws.amazon.com/s3/)
- [AWS Lambda@Edge Documentation](https://docs.aws.amazon.com/lambda/latest/dg/lambda-edge.html)
- [Amazon CloudWatch Documentation](https://docs.aws.amazon.com/cloudwatch/)

## Въпроси за дискусия
1. Какви са предимствата на използването на CDN като CloudFront за доставка на съдържание?
2. Как бихте конфигурирали CloudFront за оптимална производителност и сигурност?
3. Какви типове приложения могат да се възползват най-много от CloudFront?
